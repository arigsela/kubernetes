{
  "name": "DevOps Digest Generator",
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "cronExpression",
              "expression": "0 8 * * *"
            }
          ]
        }
      },
      "id": "580fa633-aca0-470d-aa01-e7926d6fa3f6",
      "name": "Daily 8 AM",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,x
      "position": [
        -784,
        64
      ]
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT\n    url, title, content_snippet, source_name, category, pub_date,\n    metadata->>'author' as author,\n    metadata->>'comments_count' as engagement\nFROM feed_articles\nWHERE 'devops' = ANY(topic)\n  AND pub_date >= NOW() - INTERVAL '24 hours'\n  AND (last_digest_date IS NULL OR last_digest_date < CURRENT_DATE)\nORDER BY pub_date DESC\nLIMIT 30;",
        "options": {}
      },
      "id": "b1777bae-0139-4e74-b630-61776fc8f4d7",
      "name": "Query DevOps Articles",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -560,
        64
      ],
      "credentials": {
        "postgres": {
          "id": "CnXWIqjqRo8CfL2F",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "version": 2,
            "leftValue": "",
            "caseSensitive": true,
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "check-results",
              "leftValue": "={{ $json.url }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notEmpty"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "6144f7b3-0f4b-4edc-abb0-7c9b9a273180",
      "name": "Has Articles?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -336,
        64
      ]
    },
    {
      "parameters": {
        "jsCode": "// Combine all items into a single text for the LLM, grouped by category\nconst items = $input.all();\n\nif (!items || items.length === 0) {\n  return [{\n    json: {\n      posts: 'No new articles found for today.',\n      date: new Date().toISOString().split('T')[0],\n      itemCount: 0,\n      urls: []\n    }\n  }];\n}\n\n// Group by category\nconst byCategory = { official: [], blog: [], community: [] };\nitems.forEach(item => {\n  const cat = (item.json.category || 'blog').toLowerCase();\n  if (byCategory[cat]) byCategory[cat].push(item.json);\n  else byCategory.blog.push(item.json);\n});\n\nlet postsText = '';\n\nconst categoryNames = {\n  official: 'Official Sources',\n  blog: 'Blog Posts',\n  community: 'Community Discussions'\n};\n\nfor (const [category, posts] of Object.entries(byCategory)) {\n  if (posts.length === 0) continue;\n  postsText += `\\n## ${categoryNames[category]}\\n`;\n  posts.forEach((post) => {\n    postsText += `### ${post.title}\\n`;\n    postsText += `**Source:** ${post.source_name} | **Date:** ${post.pub_date}\\n`;\n    postsText += `**Link:** ${post.url}\\n`;\n    postsText += `**Preview:** ${post.content_snippet || 'No content'}\\n\\n`;\n  });\n}\n\n// Collect URLs for marking as processed later\nconst urls = items.map(item => item.json.url);\n\nreturn [{\n  json: {\n    posts: postsText,\n    date: new Date().toISOString().split('T')[0],\n    itemCount: items.length,\n    urls: urls\n  }\n}];"
      },
      "id": "16ec9579-b19a-46e3-bc62-d66661f369bc",
      "name": "Prepare for LLM",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -112,
        -32
      ]
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "claude-haiku-4-5-20251001",
          "mode": "list",
          "cachedResultName": "Claude Haiku 4.5"
        },
        "options": {
          "maxTokensToSample": 4096
        }
      },
      "id": "7d7bca1a-4c8d-4f61-9d34-971ffb04a474",
      "name": "Claude Haiku",
      "type": "@n8n/n8n-nodes-langchain.lmChatAnthropic",
      "typeVersion": 1.3,
      "position": [
        96,
        176
      ],
      "credentials": {
        "anthropicApi": {
          "id": "FXEdoYejC4N4k4zE",
          "name": "Anthropic account"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=You are a friendly tech podcast host delivering the morning DevOps and Infrastructure news briefing. Your audience is listening to this while commuting or having their morning coffee.\n\nSpeak naturally and conversationally, as if you're talking directly to the listener. Avoid bullet points, markdown formatting, or anything that sounds robotic when read aloud. Use transitions like \"Speaking of which...\", \"Now here's something interesting...\", \"Moving on to...\", \"And you'll want to hear this one...\".\n\n## Today's Articles ({{ $json.itemCount }} items):\n{{ $json.posts }}\n\n## Your Task:\nCreate a 5-8 minute podcast script covering today's DevOps and infrastructure news. Structure it like this:\n\n1. **Opening** (30 seconds): Greet the listener warmly, mention the date, and give a quick teaser of the most exciting story.\n\n2. **Main Stories** (3-4 minutes): Cover the most significant announcements, releases, or updates. Explain why each matters and how it might affect the listener's work. Add your perspective and connect related stories.\n\n3. **Community Buzz** (2-3 minutes): Share what people are talking about - interesting Reddit discussions, debates, tips that are getting traction. Make it feel like you're sharing insider knowledge from the community.\n\n4. **Quick Hits** (1 minute): Briefly mention 2-3 smaller items worth knowing about.\n\n5. **Closing** (30 seconds): Wrap up with a thought for the day or a call to action. Wish them a good day.\n\nIMPORTANT STYLE GUIDELINES:\n- Write exactly as you would speak - use contractions, casual phrasing\n- Explain technical terms briefly when first mentioned\n- Add personality - it's okay to express opinions, make light jokes, or show enthusiasm\n- Use phrases like \"you might want to check out\", \"I found this really interesting\", \"here's the thing though\"\n- Mention source names naturally: \"Over on the DevOps subreddit, someone shared...\" or \"The folks at HashiCorp just announced...\"\n- NO markdown formatting, NO bullet points, NO headers - just flowing conversational text\n- Include natural pauses with phrases like \"So...\" or \"Now...\"\n- Aim for around 1000-1200 words for good podcast length",
        "options": {}
      },
      "id": "67daba3d-5f6a-4fa0-8b45-0a72b0fe95dc",
      "name": "AI Agent",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [
        112,
        -32
      ]
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "devops-daily-digest",
        "contextWindowLength": 10
      },
      "id": "c4ff229a-7fa5-4369-9c58-c6d9784c8c0f",
      "name": "Simple Memory",
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        208,
        176
      ]
    },
    {
      "parameters": {},
      "id": "3e71c7d0-0f93-4a5d-8842-581edd03456f",
      "name": "No New Articles",
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        -112,
        160
      ]
    },
    {
      "parameters": {
        "fromEmail": "digest@arigsela.com",
        "toEmail": "user-7b646405-60f8-4029-9ebd-3731b48d9a80@email.audioread.com",
        "subject": "=DevOps Daily Digest - {{ $('Prepare for LLM').item.json.date }}",
        "emailFormat": "text",
        "text": "={{ $json.output }}",
        "options": {}
      },
      "id": "22f748d1-bddc-4977-b73d-75ad304914d8",
      "name": "Send to Audioread",
      "type": "n8n-nodes-base.emailSend",
      "typeVersion": 2.1,
      "position": [
        464,
        -32
      ],
      "webhookId": "8bb85340-44e6-427f-b69c-4d6a7f51ac1b",
      "credentials": {
        "smtp": {
          "id": "CWrA7iYBp2VUAnmo",
          "name": "SMTP account"
        }
      }
    }
  ],
  "pinData": {},
  "connections": {
    "Daily 8 AM": {
      "main": [
        [
          {
            "node": "Query DevOps Articles",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Query DevOps Articles": {
      "main": [
        [
          {
            "node": "Has Articles?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Has Articles?": {
      "main": [
        [
          {
            "node": "Prepare for LLM",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "No New Articles",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare for LLM": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Claude Haiku": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Simple Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        [
          {
            "node": "Send to Audioread",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send to Audioread": {
      "main": [
        []
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1",
    "availableInMCP": false,
    "callerPolicy": "workflowsFromSameOwner"
  },
  "versionId": "ac2998fd-7b77-4707-bff5-4663ca17e133",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "1ac1edd945dd6547c06503f16d68924976acb661550d12289650d4bae82f1e28"
  },
  "id": "jt3u2PCVOu2hQJVXImJ-v",
  "tags": []
}