apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: coroot-ce
  namespace: argo-cd
spec:
  project: default
  source:
    repoURL: https://coroot.github.io/helm-charts
    chart: coroot-ce
    targetRevision: 0.14.4
    helm:
      values: |
        # Coroot Community Edition configuration

        # ClickHouse configuration for data storage
        clickhouse:
          shards: 1
          replicas: 1
          persistence:
            enabled: true
            size: 20Gi
            storageClass: local-path
          resources:
            requests:
              cpu: 200m
              memory: 512Mi
            limits:
              cpu: 1000m
              memory: 2Gi

        # Coroot server configuration
        coroot:
          service:
            type: ClusterIP
            port: 8080
          resources:
            requests:
              cpu: 100m
              memory: 256Mi
            limits:
              cpu: 500m
              memory: 512Mi

        # Node agent configuration (eBPF-based monitoring)
        node-agent:
          enabled: true
          resources:
            requests:
              cpu: 100m
              memory: 128Mi
            limits:
              cpu: 500m
              memory: 512Mi

        # Cluster agent for Kubernetes metadata
        cluster-agent:
          enabled: true
          resources:
            requests:
              cpu: 50m
              memory: 64Mi
            limits:
              cpu: 200m
              memory: 128Mi

        # Prometheus configuration
        # Using existing Prometheus in the cluster
        prometheus:
          enabled: false

        externalPrometheus:
          url: http://prometheus.logging.svc.cluster.local:9090
  destination:
    server: https://kubernetes.default.svc
    namespace: coroot
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
    syncOptions:
      - CreateNamespace=true
