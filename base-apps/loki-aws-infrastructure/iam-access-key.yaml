# IAM Access Key for Loki via Crossplane
# Creates AWS access credentials and stores them as a Kubernetes secret
# The secret will contain: access_key_id and secret_access_key
#
# IMPORTANT: Crossplane automatically creates the secret in the specified namespace
# No manual credential management needed - true GitOps!

apiVersion: iam.aws.upbound.io/v1beta1
kind: AccessKey
metadata:
  name: loki-s3-credentials
  labels:
    app: loki
    component: iam-access-key
    managed-by: crossplane
spec:
  forProvider:
    # Reference the IAM user
    userRef:
      name: loki-s3-user
  # Crossplane will write the credentials to this Kubernetes secret
  writeConnectionSecretToRef:
    name: loki-s3-credentials
    namespace: logging
  providerConfigRef:
    name: default
